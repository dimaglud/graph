<script lang="javascript">

    window.addEventListener('resize', function(event) {
        drawGraph();
    }, true);

    function drawGraph() {
        const container = document.getElementById('graph');
        const dot = document.getElementById('graph_dot');

        const width = container.offsetWidth;
        const height = container.offsetHeight;
        

        const weightInput = document.getElementById('inpWeight');
        const weight = +weightInput.value;

        // added height (heightM)
        const heightInput = document.getElementById('inpHeight');
        const heightM = +heightInput.value;

        // added Pulse
        const pulseInput = document.getElementById('inpPulse');
        const pulse = +pulseInput.value;

        // added Pressure Upper (PressureU)
        const pressureInputU = document.getElementById('inpPressureU');
        const pressureU = +pressureInputU.value;

        // added Pressure Lower (PressureL)
        const pressureInputL = document.getElementById('inpPressureL');
        const pressureL = +pressureInputL.value;

        // added Age
        const ageInput = document.getElementById('inpAge');
        const age = ageInput.value;

        //TODO: get other needed parameters from inputs
        //TODO: add validation 

        var weightIndex = getWeightIndex(weight,heightM);
        var healthIndex = getHealthIndex(pulse,pressureU,pressureL,age,weight,heightM);
        
        //var weightIndex = 18.5;
        //var healthIndex = 0.825;
        
        console.log("индекс Веса: " + weightIndex + " индекс Здоровья: " + healthIndex);

        //TODO: ajust coordinates to container width

        //var x = 10 * weightIndex - 86;
        //var y = 200 * healthIndex - 41;


        var kX = width/270;
        var kY = height/175;

        var x = 10 * weightIndex - 86;
        x = kX*x;

        var y = 200 * healthIndex - 41;
        y = kY*y;

        dot.style.left = x;
        dot.style.bottom = y;

    }

    //TODO: use this function 
    function getFieldValue(name) {
        const heightInput = document.getElementById(name);
        const heightM = +heightInput.value;
    }

    function getWeightIndex(weight, heightM) {
        //TODO: make formula more readable
        let weight1;
        weight1=weight*10000;
        let heightSQ;
        heightSQ = heightM **2;
        return weight1/heightSQ;
    }

    function getHealthIndex(pulse, pressureU, pressureL, age, weight, heightM) {
        let pressureAvg = (pressureU - pressureL) / 3 + pressureL;
        let indexU = 700 - 3 * pulse - 2.5 * pressureAvg - 2.7 * age + 0.28 * weight;
        let indexL = 350 - 2.6 * age + 0.21 * heightM;

        return indexU/indexL; 
    }

//TODO: delete me
    function getHealthIndex2(pulse, pressureU, pressureL, age, weight, heightM) {
        let pressureAvg = (pressureU - pressureL)/3 + pressureL;

        let indexU = (700 - (3 * pulse));
        indexU = indexU - (2.5 * pressureAvg);
        indexU -= 2.7 * age;
        indexU += 0.28 * weight;
        
        let index2a = 350 - (2.6 * age);
        let index2 = index2a + (0.21*heightM);

        return index1/index2; 
    }

</script>

<style>

.main-container {
    display: flex;
}

.form-container {
}

.form-row
{

}

.form-row label {
    font-family: 'Open Sans';
font-style: normal;
font-weight: 400;
font-size: 13.5739px;
} 

.btn-main {
    border-block-width: 2px;
}

.graph-container {

    width: 40%;
    height: fit-content;
 
/*
    width: 270;
    height: 175;
*/  
}

.graph-dot {
    width: 10px;
    height: 10px;
    position: relative;
    z-index: 2;
}


.graph-grid {
    width: 100%;
    height: 100%;
}
</style>

<div class="main-container">
   
    <div class="graph-container" id="graph">
        <img class="graph-grid" src="./img/graph.svg" />
        <img class="graph-dot" id="graph_dot" src="./img/dot.svg" />
    </div>

    <div class="form-container">
        <div class="form-row">
            <label>Вага, кг</label>
            <input type="number" id="inpWeight" value="60"/>
        </div>
        Зріст, см: <input type="number" id="inpHeight"  value="168"/> <br/><br/>
        ------------------------------------------- <br/><br/>
        Пульс, уд/хв: <input type="number" id="inpPulse"  value="67"/><br/><br/>
        Тиск, верхній/нижній: <input type="number" id="inpPressureU"  value="120"/>/<input type="number" id="inpPressureL" value="80"/> <br/><br/>
        Вік, років: <input type="number" id="inpAge" value="39"/>
        
        <input class="btn-main" type="button" onclick="drawGraph()" value="Submit" />
    </div>
</div>
