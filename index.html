<script lang="javascript">

    window.addEventListener('resize', function(event) {
        drawGraph();
    }, true);

    function drawGraph() {
        const container = document.getElementById('graph');
        const dot = document.getElementById('graph_dot');

        const width = container.offsetWidth;
        const height = container.offsetHeight;
        

        const weightInput = document.getElementById('inpWeight');
        const weight = +weightInput.value;

        // added height (heightM)
        const heightInput = document.getElementById('inpHeight');
        const heightM = +heightInput.value;

        // added Pulse
        const pulseInput = document.getElementById('inpPulse');
        const pulse = +pulseInput.value;

        // added Pressure Upper (PressureU)
        const pressureInputU = document.getElementById('inpPressureU');
        const pressureU = +pressureInputU.value;

        // added Pressure Lower (PressureL)
        const pressureInputL = document.getElementById('inpPressureL');
        const pressureL = +pressureInputL.value;

        // added Age
        const ageInput = document.getElementById('inpAge');
        const age = ageInput.value;

        //TODO: get other needed parameters from inputs
        //TODO: add validation 

        var weightIndex = getWeightIndex(weight,heightM);
        var healthIndex = getHealthIndex(pulse,pressureU,pressureL,age,weight,heightM);
        
        const weightSpan = document.getElementById(`weightIndex`);
        weightSpan.innerText = weightIndex;

        const imtSpan = document.getElementById(`healthIndex`);
        imtSpan.innerText = healthIndex;
        
        // var weightIndex = 18.5;
        // var healthIndex = 0.525;
        
        console.log("индекс Веса: " + weightIndex + " индекс Здоровья: " + healthIndex);

        var kX = width/296;
        var kY = height/219;

        var x = 5 * weightIndex - 35;
        x = kX*x;

        var y = 200 * healthIndex - 22;
        y = kY*y;

        dot.style.left = x;
        dot.style.bottom = y;
    }

    //TODO: use this function 
    function getFieldValue(name) {
        const heightInput = document.getElementById(name);
        const heightM = +heightInput.value;
    }

    function getWeightIndex(weight, heightM) {
        //TODO: make formula more readable
        let weight1;
        weight1=weight*10000;
        let heightSQ;
        heightSQ = heightM **2;
        return weight1/heightSQ;
    }

    function getHealthIndex(pulse, pressureU, pressureL, age, weight, heightM) {
        let pressureAvg = (pressureU - pressureL) / 3 + pressureL;
        let indexU = 700 - 3 * pulse - 2.5 * pressureAvg - 2.7 * age + 0.28 * weight;
        let indexL = 350 - 2.6 * age + 0.21 * heightM;

        return indexU/indexL; 
    }

//TODO: delete me
    function getHealthIndex2(pulse, pressureU, pressureL, age, weight, heightM) {
        let pressureAvg = (pressureU - pressureL)/3 + pressureL;

        let indexU = (700 - (3 * pulse));
        indexU = indexU - (2.5 * pressureAvg);
        indexU -= 2.7 * age;
        indexU += 0.28 * weight;
        
        let index2a = 350 - (2.6 * age);
        let index2 = index2a + (0.21*heightM);

        return index1/index2; 
    }

</script>

<style>

input[type="number"] {
    width: 130px;
    height: 30px;
    font-size: 15px;
    margin-bottom: 5px;
    border-radius: 4px;
    padding-left: 10px;
}

input[type=number]:hover {
  border-color: rgb(126, 10, 10);
}

input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

::placeholder {
  color: gray;
  opacity: 0.5; /* Firefox */
}

.main-container {
    display: flex;
}

.form-container {
    margin: 5% 0;
    padding-left: 10px;
}

.form-row
{

}

div.field {
  padding-bottom: 10px;
  margin-left: 10px;
  vertical-align:middle;
}

div.field label {
    font-family: 'Open Sans';
    font-style: normal;
    display: block;
    float: left;
    margin-right: 5px;
    width: 80px;
    height: 15px;
}

div.result-form {
  padding-bottom: 10px;
  margin-left: 10px;
  vertical-align:middle;
}


.form-row label {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: 400;
    font-size: 14px;
    height: 40px;
} 

.btn-main {
    border: none;
    padding: 10px 30px;
    margin: 20px 0 20px 0;
}

.graph-container {

    width: 40%;
    height: fit-content;
 
/*
    width: 270;
    height: 175;
*/  
}

.graph-dot {
    width: 10px;
    height: 10px;
    position: relative;
    z-index: 2;
}


.graph-grid {
    width: 100%;
    height: 100%;
}
</style>

<div class="main-container">

<link href='https://fonts.googleapis.com/css?family=Open Sans' rel='stylesheet'> 
   
    <div class="graph-container" id="graph">
        <img class="graph-grid" src="./img/graph_man.svg" />
        <img class="graph-dot" id="graph_dot" src="./img/dot.svg" />
    </div>

    <div class="form-container">

        <div class="field">
            <label>Пол:</label>
        
            <input type="radio" class="btn-check" name="options" id="option1" autocomplete="off" Мужчина>
            <label class="btn btn-secondary" for="option1">Мужчина</label>

            <input type="radio" class="btn-check" name="options" id="option2" autocomplete="off">
            <label class="btn btn-secondary" for="option2">Женщина</label>
        </div>

        <div class="form-row">
            
        </div>

        <div class="field">
            <label>Вес, кг</label>
            <input type="number" id="inpWeight" value="60"/>
        </div>
        
        <div class="field">
            <label>Рост, см:</label>
            <input type="number" id="inpHeight"  value="168"/>
        </div>

        <div class="field">
            <label>Пульс:</label>
            <input type="number" id="inpPulse"  value="67"/>
        </div>

        <div class="field">
            <label>Давление:</label>
            <input type="number" id="inpPressureU"  value="120"/>/<input type="number" id="inpPressureL" value="80"/>
        </div>

        <div class="field">
            <label>Возраст:</label>
            <input type="number" id="inpAge" placeholder="лет" value="39"/>
        </div>
         
        <div class="field">
            <label></label>
            <input class="btn-main" type="button" onclick="drawGraph()" value="Посчитать" />
        </div>

            <div class="result-form">
                <label>Ваше соматическое здоровье:</label>
                <span id="weightIndex"></span>
                
            </div>
            <div class="result-form">
                <label>Ваш ИМТ:</label>
                
                <span id="healthIndex"></span>  
            </div>

    </div>

</div>
